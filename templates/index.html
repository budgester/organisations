<!DOCTYPE html>
<html>
<head>
    <title>Organisations</title>
    <style>
        body { font-family: sans-serif; margin: 40px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #4CAF50; color: white; cursor: pointer; }
        th:hover { background-color: #45a049; }
        th::after { content: ' ⇅'; opacity: 0.5; }
        th.asc::after { content: ' ↑'; opacity: 1; }
        th.desc::after { content: ' ↓'; opacity: 1; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        tr:hover { background-color: #ddd; }
        #searchBox { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        #searchBox:focus { outline: none; border-color: #4CAF50; }
    </style>
</head>
<body>
    <h1>Organisations</h1>
    <input type="text" id="searchBox" onkeyup="filterTable()" placeholder="Search organisations...">
    <table id="orgTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">ID</th>
                <th onclick="sortTable(1)">Name</th>
                <th onclick="sortTable(2)">Description</th>
            </tr>
        </thead>
        <tbody>
            {% for org in organisations %}
            <tr>
                <td>{{ org.id }}</td>
                <td>{{ org.name }}</td>
                <td>{{ org.description or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p>
        <a href="/docs">API Documentation</a> |
        <a href="https://github.com/budgester/organisations">GitHub</a>
    </p>
    <script>
        let sortDirection = [true, true, true];
        function sortTable(colIndex) {
            const table = document.getElementById("orgTable");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            const headers = table.querySelectorAll("th");

            headers.forEach((h, i) => {
                h.classList.remove("asc", "desc");
                if (i === colIndex) {
                    h.classList.add(sortDirection[colIndex] ? "asc" : "desc");
                }
            });

            rows.sort((a, b) => {
                let aVal = a.cells[colIndex].textContent;
                let bVal = b.cells[colIndex].textContent;
                if (colIndex === 0) {
                    aVal = parseInt(aVal);
                    bVal = parseInt(bVal);
                }
                if (aVal < bVal) return sortDirection[colIndex] ? -1 : 1;
                if (aVal > bVal) return sortDirection[colIndex] ? 1 : -1;
                return 0;
            });

            sortDirection[colIndex] = !sortDirection[colIndex];
            rows.forEach(row => tbody.appendChild(row));
        }

        function filterTable() {
            const query = document.getElementById("searchBox").value.toLowerCase();
            const tbody = document.getElementById("orgTable").querySelector("tbody");
            const rows = tbody.querySelectorAll("tr");

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? "" : "none";
            });
        }
    </script>
</body>
</html>
